<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <!-- Required Info -->
  <title>Libby's Phone</title>
  <meta name="description" content="The State of Indiana v. Richard M. Allen | @AllEyesOnDelphi GitHub">
  <link rel="canonical" href="https://alleyesondelphi.github.io/rickallen/Libbys-phone.html">

  <!-- Open Graph (Facebook, LinkedIn, etc.) -->
  <meta property="og:title" content="Libby's Phone">
  <meta property="og:description" content="The State of Indiana v. Richard M. Allen | @AllEyesOnDelphi GitHub">
  <meta property="og:type" content="website"> 
  <meta property="og:url" content="https://alleyesondelphi.github.io/rickallen/Libbys-phone.html">
  <meta property="og:image" content="https://alleyesondelphi.github.io/rickallen/assets/img/preview-img/Libbys-phone.png">
  <meta property="og:image:width" content="1280">
  <meta property="og:image:height" content="640">
  <meta property="og:site_name" content="IN v. RA | All Eyes on Delphi">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image"> 
  <meta name="twitter:title" content="Libby's Phone">
  <meta name="twitter:description" content="The State of Indiana v. Richard M. Allen | @AllEyesOnDelphi GitHub">
  <meta name="twitter:image" content="https://alleyesondelphi.github.io/rickallen/assets/img/preview-img/Libbys-phone.png">
  <meta name="twitter:creator" content="@alleyesondelphi">

  <!-- Favicons -->
  <link href="favicon.ico" rel="icon" sizes="any">
  <link href="apple-touch-icon.png" rel="apple-touch-icon">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favs/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favs/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favs/favicon-16x16.png">
  <link rel="manifest" href="assets/img/favs/site.webmanifest">

  <!-- Style Sheet -->
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #0a0a0a;
  --bg-secondary: #111111;
  --bg-card: #161616;
  --bg-card-hover: #1c1c1c;
  --border: #222222;
  --border-accent: #333333;
  --text-primary: #e8e8e8;
  --text-secondary: #888888;
  --text-muted: #555555;
  --accent-amber: #f5a623;
  --accent-amber-dim: rgba(245, 166, 35, 0.15);
  --accent-red: #e84855;
  --accent-red-dim: rgba(232, 72, 85, 0.12);
  --accent-green: #3dd68c;
  --accent-green-dim: rgba(61, 214, 140, 0.12);
  --accent-blue: #4a9eff;
  --accent-blue-dim: rgba(74, 158, 255, 0.12);
  --accent-purple: #a78bfa;
  --accent-purple-dim: rgba(167, 139, 250, 0.12);
  --mono: 'JetBrains Mono', monospace;
  --sans: 'DM Sans', sans-serif;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg-primary);
  color: var(--text-primary);
  font-family: var(--sans);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--border-accent); border-radius: 3px; }

/* Header */
.header {
  padding: 48px 40px 32px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(180deg, #0f0f0f 0%, var(--bg-primary) 100%);
}
.header-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--accent-amber);
  margin-bottom: 12px;
}
.header h1 {
  font-family: var(--mono);
  font-size: 28px;
  font-weight: 600;
  letter-spacing: -0.5px;
  margin-bottom: 8px;
}
.header-meta {
  font-size: 14px;
  color: var(--text-secondary);
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
}
.header-meta span {
  display: flex;
  align-items: center;
  gap: 6px;
}
.header-meta .dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: inline-block;
}

/* Layout */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 40px;
}

/* Section */
.section {
  padding: 48px 0;
  border-bottom: 1px solid var(--border);
}
.section:last-child { border-bottom: none; }

.section-header {
  display: flex;
  align-items: baseline;
  gap: 12px;
  margin-bottom: 8px;
}
.section-number {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 600;
  color: var(--accent-amber);
  background: var(--accent-amber-dim);
  padding: 4px 10px;
  border-radius: 4px;
}
.section-title {
  font-size: 20px;
  font-weight: 600;
  letter-spacing: -0.3px;
}
.section-desc {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 28px;
  max-width: 700px;
}

/* Stat cards */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
  margin-bottom: 32px;
}
.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
  transition: border-color 0.2s;
}
.stat-card:hover { border-color: var(--border-accent); }
.stat-label {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 8px;
}
.stat-value {
  font-family: var(--mono);
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -1px;
}
.stat-unit {
  font-size: 13px;
  font-weight: 400;
  color: var(--text-secondary);
  margin-left: 4px;
}
.stat-note {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 4px;
}

/* App bar chart */
.app-bar-list { display: flex; flex-direction: column; gap: 8px; }
.app-bar-row {
  display: grid;
  grid-template-columns: 160px 1fr 70px;
  align-items: center;
  gap: 12px;
  font-size: 13px;
}
.app-bar-name {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.app-bar-track {
  height: 24px;
  background: var(--bg-secondary);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}
.app-bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 1s cubic-bezier(0.22, 1, 0.36, 1);
  position: relative;
}
.app-bar-fill::after {
  content: '';
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 2px;
  background: rgba(255,255,255,0.3);
  border-radius: 1px;
}
.app-bar-value {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-secondary);
  text-align: right;
}

/* Timeline */
.timeline-container {
  position: relative;
  padding-left: 28px;
}
.timeline-container::before {
  content: '';
  position: absolute;
  left: 6px;
  top: 0;
  bottom: 0;
  width: 1px;
  background: var(--border-accent);
}
.timeline-day {
  position: relative;
  margin-bottom: 32px;
}
.timeline-day::before {
  content: '';
  position: absolute;
  left: -24px;
  top: 8px;
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: var(--bg-primary);
  border: 2px solid var(--accent-amber);
}
.timeline-date {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 600;
  color: var(--accent-amber);
  margin-bottom: 4px;
}
.timeline-day-meta {
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 12px;
}
.timeline-apps {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.timeline-app-tag {
  font-family: var(--mono);
  font-size: 11px;
  padding: 4px 10px;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  white-space: nowrap;
}
.timeline-app-tag .time {
  color: var(--text-primary);
  font-weight: 500;
}
.timeline-gap {
  position: relative;
  margin-bottom: 32px;
  padding: 12px 16px;
  background: var(--accent-red-dim);
  border: 1px solid rgba(232, 72, 85, 0.2);
  border-radius: 6px;
  font-size: 13px;
  color: var(--accent-red);
}
.timeline-gap::before {
  content: '';
  position: absolute;
  left: -24px;
  top: 50%;
  transform: translateY(-50%);
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: var(--accent-red);
  border: 2px solid var(--accent-red);
}

/* Battery chart */
.battery-chart-container {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 24px;
  margin-bottom: 16px;
}
.battery-chart-title {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-secondary);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 16px;
}
.battery-svg { width: 100%; height: auto; }

/* Anomaly cards */
.anomaly-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  gap: 16px;
}
.anomaly-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 24px;
  border-left: 3px solid var(--accent-red);
}
.anomaly-card.info {
  border-left-color: var(--accent-blue);
}
.anomaly-card.warn {
  border-left-color: var(--accent-amber);
}
.anomaly-card.ok {
  border-left-color: var(--accent-green);
}
.anomaly-severity {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.anomaly-severity.high { color: var(--accent-red); }
.anomaly-severity.medium { color: var(--accent-amber); }
.anomaly-severity.low { color: var(--accent-blue); }
.anomaly-severity.clear { color: var(--accent-green); }
.anomaly-title {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 8px;
}
.anomaly-desc {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.7;
}
.anomaly-detail {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-muted);
  background: var(--bg-secondary);
  border-radius: 4px;
  padding: 12px;
  margin-top: 12px;
  overflow-x: auto;
  white-space: pre;
  line-height: 1.8;
}

/* Hourly heatmap */
.heatmap-row {
  display: grid;
  grid-template-columns: 50px repeat(24, 1fr);
  gap: 3px;
  align-items: center;
  margin-bottom: 3px;
}
.heatmap-label {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-muted);
  text-align: right;
  padding-right: 8px;
}
.heatmap-cell {
  aspect-ratio: 1;
  border-radius: 3px;
  position: relative;
  cursor: default;
  min-height: 18px;
}
.heatmap-cell[data-tooltip]:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--mono);
  font-size: 10px;
  background: #222;
  color: var(--text-primary);
  padding: 4px 8px;
  border-radius: 4px;
  white-space: nowrap;
  z-index: 10;
  pointer-events: none;
}
.heatmap-hours {
  display: grid;
  grid-template-columns: 50px repeat(24, 1fr);
  gap: 3px;
  margin-bottom: 8px;
}
.heatmap-hour {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-muted);
  text-align: center;
}

/* Footer */
.footer {
  padding: 32px 0;
  text-align: center;
  font-size: 12px;
  color: var(--text-muted);
  font-family: var(--mono);
}

/* Dual battery viz */
.dual-battery-viz {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-top: 16px;
}
.dual-stream {
  background: var(--bg-secondary);
  border-radius: 6px;
  padding: 16px;
}
.dual-stream-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  margin-bottom: 8px;
}
.dual-stream-label.a { color: var(--accent-amber); }
.dual-stream-label.b { color: var(--accent-blue); }
.dual-reading {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-secondary);
  line-height: 1.8;
}

@media (max-width: 768px) {
  .header { padding: 32px 20px 24px; }
  .container { padding: 0 20px; }
  .stat-grid { grid-template-columns: repeat(2, 1fr); }
  .anomaly-grid { grid-template-columns: 1fr; }
  .app-bar-row { grid-template-columns: 120px 1fr 60px; }
  .dual-battery-viz { grid-template-columns: 1fr; }
  .heatmap-row { grid-template-columns: 40px repeat(24, 1fr); gap: 2px; }
}
</style>
</head>
<body>

<div class="header">
  <div class="container">
    <div class="header-label">Forensic Analysis</div>
    <h1>knowledgeC.db — Phone Activity Data</h1>
    <div class="header-meta">
      <span><span class="dot" style="background:var(--accent-green)"></span> 3,732 records</span>
      <span><span class="dot" style="background:var(--accent-amber)"></span> Feb 12 – Oct 11, 2017</span>
      <span><span class="dot" style="background:var(--accent-blue)"></span> iOS knowledgeC (Apple CoreData)</span>
      <span><span class="dot" style="background:var(--accent-purple)"></span> Timezone: UTC-5 (EST)</span>
    </div>
  </div>
</div>

<div class="container">

  <!-- OVERVIEW -->
  <div class="section">
    <div class="section-header">
      <span class="section-number">01</span>
      <span class="section-title">Overview</span>
    </div>
    <p class="section-desc">
      This database is an Apple knowledgeC.db file — an iOS system database that silently logs device activity including app usage, screen state, battery levels, and lock/unlock events. Here's what it contains.
    </p>
    <div class="stat-grid">
      <div class="stat-card">
        <div class="stat-label">Total Records</div>
        <div class="stat-value">3,732</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">App Sessions</div>
        <div class="stat-value">346</div>
        <div class="stat-note">Foreground app events</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Screen Events</div>
        <div class="stat-value">690</div>
        <div class="stat-note">Screen on/off cycles</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Battery Readings</div>
        <div class="stat-value">481</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Lock/Unlock</div>
        <div class="stat-value">267</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Active Days</div>
        <div class="stat-value">9</div>
        <div class="stat-note">With recorded usage</div>
      </div>
    </div>
  </div>

  <!-- APP USAGE -->
  <div class="section">
    <div class="section-header">
      <span class="section-number">02</span>
      <span class="section-title">App Usage</span>
    </div>
    <p class="section-desc">
      Total time each app spent in the foreground (actively on screen). The app mix — Snapchat, Instagram, Musical.ly, Candy Crush, a school portal (Skyward), Houseparty — is consistent with a teenager's phone circa early 2017.
    </p>
    <div class="app-bar-list" id="appBars"></div>
  </div>

  <!-- DAILY TIMELINE -->
  <div class="section">
    <div class="section-header">
      <span class="section-number">03</span>
      <span class="section-title">Daily Timeline</span>
    </div>
    <p class="section-desc">
      Activity is concentrated into just a handful of days. The large gaps in between — especially the 194-day silence from February to September — are notable.
    </p>
    <div class="timeline-container" id="timeline"></div>
  </div>

  <!-- HOURLY ACTIVITY HEATMAP -->
  <div class="section">
    <div class="section-header">
      <span class="section-number">04</span>
      <span class="section-title">Hourly Activity Pattern</span>
    </div>
    <p class="section-desc">
      When the phone was actively being used, by hour of day (local time, EST/UTC-5). Usage peaks in the early afternoon and late evening — consistent with a school-age user.
    </p>
    <div id="heatmap"></div>
  </div>

  <!-- BATTERY -->
  <div class="section">
    <div class="section-header">
      <span class="section-number">05</span>
      <span class="section-title">Battery Behavior</span>
    </div>
    <p class="section-desc">
      Battery percentage over time for the two periods with dense data. Charging events (plugged in) are shown in green. The February data looks normal. October 11 is where it gets strange.
    </p>
    <div class="battery-chart-container">
      <div class="battery-chart-title">February 12–13, 2017 (local time)</div>
      <svg id="batteryFeb" class="battery-svg" viewBox="0 0 800 200"></svg>
    </div>
    <div class="battery-chart-container">
      <div class="battery-chart-title">October 11, 2017 — Dual Battery Streams (local time)</div>
      <svg id="batteryOct" class="battery-svg" viewBox="0 0 800 200"></svg>
    </div>
  </div>

  <!-- ANOMALIES -->
  <div class="section">
    <div class="section-header">
      <span class="section-number">06</span>
      <span class="section-title">Anomaly Assessment</span>
    </div>
    <p class="section-desc">
      Every database artifact examined for inconsistencies. Each finding is rated by severity. One significant anomaly was identified.
    </p>
    <div class="anomaly-grid">

      <div class="anomaly-card">
        <div class="anomaly-severity high">High — Significant Anomaly</div>
        <div class="anomaly-title">Dual Simultaneous Battery Streams</div>
        <div class="anomaly-desc">
          On October 11, the database records <strong>two parallel battery percentage readings</strong> running at the same timestamps. Stream A climbs from 34% → 42%. Stream B climbs from 3% → 23%. A single phone cannot report two battery levels at once. This likely indicates data merged from two devices (backup/restore), an iOS upgrade artifact, or an extraction error.
        </div>
        <div class="anomaly-detail">17:46 UTC  Stream A: 35%    Stream B: 3%
17:49 UTC  Stream A: 36%    Stream B: 6%
17:52 UTC  Stream A: 38%    Stream B: 9%
17:55 UTC  Stream A: 40%    Stream B: 12%
17:59 UTC  Stream A: 42%    Stream B: 16%</div>
      </div>

      <div class="anomaly-card warn">
        <div class="anomaly-severity medium">Medium — Notable</div>
        <div class="anomaly-title">194-Day Data Gap</div>
        <div class="anomaly-desc">
          No data exists between Feb 23 and Sep 5, 2017 — a gap of nearly 194 days. This could mean the phone was powered off, factory reset, the database was pruned by iOS, or the forensic extraction only captured partial data. Two additional gaps of 1.7 and 2.8 days exist within the February window.
        </div>
      </div>

      <div class="anomaly-card warn">
        <div class="anomaly-severity medium">Medium — Notable</div>
        <div class="anomaly-title">14 Zero-Duration App Sessions</div>
        <div class="anomaly-desc">
          14 app events were logged as "in focus" for exactly 0 seconds. Most are iMessage (notification taps). Three occur in rapid succession on Feb 20 at 2:37 PM local time — PhotoMath, Subway Surfers, Color Switch — consistent with quickly swiping through the app switcher. Not necessarily suspicious, but unusual to see this many.
        </div>
      </div>

      <div class="anomaly-card info">
        <div class="anomaly-severity low">Low — Expected Behavior</div>
        <div class="anomaly-title">Screen On While Locked (5 events)</div>
        <div class="anomaly-desc">
          Five instances where the screen was illuminated while the device was locked, lasting 30–68 seconds each. This is normal — lock screen notifications, incoming calls, and Siri activation all cause this.
        </div>
      </div>

      <div class="anomaly-card info">
        <div class="anomaly-severity low">Low — Expected Behavior</div>
        <div class="anomaly-title">Small Battery Gain Without Charging</div>
        <div class="anomaly-desc">
          On Feb 15, battery rose from 53% → 56% over 28 minutes while reportedly unplugged. This is within normal battery calibration drift and is not meaningful.
        </div>
      </div>

      <div class="anomaly-card ok">
        <div class="anomaly-severity clear">Clear — No Issues</div>
        <div class="anomaly-title">No Overlapping App Sessions</div>
        <div class="anomaly-desc">
          No instances of two different apps reported as "in focus" at the same time. App transitions are clean and sequential.
        </div>
      </div>

      <div class="anomaly-card ok">
        <div class="anomaly-severity clear">Clear — No Issues</div>
        <div class="anomaly-title">No Negative Durations</div>
        <div class="anomaly-desc">
          No events where the end timestamp precedes the start timestamp. All duration calculations are valid.
        </div>
      </div>

      <div class="anomaly-card ok">
        <div class="anomaly-severity clear">Clear — No Issues</div>
        <div class="anomaly-title">No Duplicate Primary Keys</div>
        <div class="anomaly-desc">
          Database structural integrity is intact. No duplicate records, no orphaned child entries without parents, no evidence of manual row insertion or editing.
        </div>
      </div>

    </div>
  </div>

  <!-- METHODOLOGY -->
  <div class="section">
    <div class="section-header">
      <span class="section-number">07</span>
      <span class="section-title">What Is This Database?</span>
    </div>
    <p class="section-desc" style="max-width:800px;">
      <strong>knowledgeC.db</strong> is a Core Data–backed SQLite database maintained by Apple's "Knowledge" system daemon on iOS and macOS. It silently records device usage events — which app is in the foreground, screen on/off state, battery level, charging status, lock state, audio routing, Siri usage, and media playback. The data is stored with Apple Core Data timestamps (seconds since January 1, 2001 00:00:00 UTC). This database is commonly extracted during forensic examinations of Apple devices and is a standard artifact in mobile forensics toolkits. All times in this analysis have been converted to local time (UTC-5 / Eastern Standard Time) unless otherwise noted.
    </p>
  </div>

  <div class="footer">
    Analysis generated from knowledgeC.db · 3,732 records · Feb–Oct 2017
  </div>
</div>

<script>
// ============================================================
// APP USAGE DATA
// ============================================================
const apps = [
  { name: "Snapchat", bundle: "picaboo", mins: 239.4, sessions: 129, color: "#FFFC00" },
  { name: "Instagram", bundle: "instagram", mins: 82.9, sessions: 39, color: "#E1306C" },
  { name: "Facebook", bundle: "Facebook", mins: 68.9, sessions: 25, color: "#4267B2" },
  { name: "Mail", bundle: "mobilemail", mins: 46.0, sessions: 10, color: "#4a9eff" },
  { name: "Settings", bundle: "Preferences", mins: 42.5, sessions: 21, color: "#8E8E93" },
  { name: "Photos", bundle: "mobileslideshow", mins: 27.6, sessions: 11, color: "#a78bfa" },
  { name: "Cool Monkey", bundle: "monkey", mins: 25.8, sessions: 12, color: "#3dd68c" },
  { name: "iMessage", bundle: "MobileSMS", mins: 18.0, sessions: 43, color: "#34C759" },
  { name: "Messenger", bundle: "Messenger", mins: 12.0, sessions: 8, color: "#0099FF" },
  { name: "Musical.ly", bundle: "musically", mins: 8.5, sessions: 4, color: "#fe2c55" },
  { name: "Gmail", bundle: "Gmail", mins: 6.2, sessions: 2, color: "#EA4335" },
  { name: "Safari", bundle: "mobilesafari", mins: 6.1, sessions: 10, color: "#5AC8FA" },
];

const maxMin = apps[0].mins;
const barsContainer = document.getElementById("appBars");

apps.forEach((app, i) => {
  const pct = (app.mins / maxMin) * 100;
  const row = document.createElement("div");
  row.className = "app-bar-row";
  row.innerHTML = `
    <div class="app-bar-name">${app.name}</div>
    <div class="app-bar-track">
      <div class="app-bar-fill" style="width:0%;background:${app.color};opacity:0.7;" data-width="${pct}"></div>
    </div>
    <div class="app-bar-value">${app.mins >= 60 ? (app.mins/60).toFixed(1) + 'h' : Math.round(app.mins) + 'm'} <span style="color:var(--text-muted)">(${app.sessions})</span></div>
  `;
  barsContainer.appendChild(row);
});

// Animate bars on scroll
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.querySelectorAll('.app-bar-fill').forEach(bar => {
        bar.style.width = bar.dataset.width + '%';
      });
    }
  });
}, { threshold: 0.2 });
observer.observe(barsContainer);

// ============================================================
// TIMELINE
// ============================================================
const timelineDays = [
  {
    date: "Feb 12, 2017 (Sun)",
    local: "2:36 PM – 5:17 PM",
    totalMin: 104,
    apps: [
      { name: "Snapchat", min: 47.5 },
      { name: "Cool Monkey", min: 24.9 },
      { name: "iMessage", min: 11.2 },
      { name: "Facebook", min: 10.5 },
    ]
  },
  {
    date: "Feb 13, 2017 (Mon)",
    local: "7:08 PM – 11:25 PM",
    totalMin: 162,
    apps: [
      { name: "Snapchat", min: 73.5 },
      { name: "Facebook", min: 47.9 },
      { name: "Instagram", min: 25.2 },
      { name: "Musical.ly", min: 5.9 },
      { name: "iMessage", min: 4.8 },
    ]
  },
  { gap: true, label: "1.7 days — no data" },
  {
    date: "Feb 15, 2017 (Wed)",
    local: "3:06 PM – 4:03 PM",
    totalMin: 25,
    apps: [
      { name: "Settings", min: 12.2 },
      { name: "Snapchat", min: 10.8 },
    ]
  },
  { gap: true, label: "1.9 days — no data" },
  {
    date: "Feb 17, 2017 (Fri)",
    local: "3:02 PM – 3:37 PM",
    totalMin: 4.5,
    apps: [
      { name: "Instagram", min: 1.9 },
      { name: "Camera", min: 1.0 },
    ]
  },
  { gap: true, label: "2.8 days — no data" },
  {
    date: "Feb 20, 2017 (Mon) ★ Heaviest Day",
    local: "11:31 AM – 3:34 PM",
    totalMin: 277,
    apps: [
      { name: "Snapchat", min: 104.4 },
      { name: "Instagram", min: 50.5 },
      { name: "Mail", min: 45.6 },
      { name: "Photos", min: 22.9 },
      { name: "Settings", min: 15.8 },
      { name: "Messenger", min: 12.0 },
    ]
  },
  {
    date: "Feb 21, 2017 (Tue)",
    local: "1:12 PM – 2:51 PM",
    totalMin: 15,
    apps: [
      { name: "Settings", min: 3.1 },
      { name: "Snapchat", min: 3.0 },
      { name: "Facebook", min: 2.9 },
    ]
  },
  {
    date: "Feb 22, 2017 (Wed)",
    local: "1:55 PM – 2:00 PM",
    totalMin: 3.5,
    apps: [
      { name: "Safari", min: 1.7 },
      { name: "Settings", min: 1.2 },
    ]
  },
  {
    date: "Feb 23, 2017 (Thu)",
    local: "9:57 AM – 10:06 AM",
    totalMin: 9,
    apps: [
      { name: "Settings", min: 9.0 },
    ]
  },
  { gap: true, label: "193.9 days — no data (Feb 23 → Sep 5)" },
  {
    date: "Sep 5, 2017 (Tue)",
    local: "No app sessions",
    totalMin: 0,
    apps: [],
    note: "Battery and charging events only — phone plugged in, charged from 8% → 19%"
  },
  { gap: true, label: "36.1 days — no data (Sep 5 → Oct 11)" },
  {
    date: "Oct 11, 2017 (Wed)",
    local: "12:56 PM – 2:07 PM",
    totalMin: 1.2,
    apps: [
      { name: "Settings", min: 1.2 },
    ],
    note: "Dual battery streams detected (see Anomalies)"
  },
];

const timelineEl = document.getElementById("timeline");
timelineDays.forEach(day => {
  if (day.gap) {
    const el = document.createElement("div");
    el.className = "timeline-gap";
    el.textContent = "⚠ GAP: " + day.label;
    timelineEl.appendChild(el);
    return;
  }
  const el = document.createElement("div");
  el.className = "timeline-day";
  let appsHtml = day.apps.map(a =>
    `<span class="timeline-app-tag"><span class="time">${a.min >= 60 ? (a.min/60).toFixed(1)+'h' : Math.round(a.min)+'m'}</span> ${a.name}</span>`
  ).join('');
  let noteHtml = day.note ? `<div style="font-size:12px;color:var(--accent-amber);margin-top:8px;">⚠ ${day.note}</div>` : '';
  el.innerHTML = `
    <div class="timeline-date">${day.date}</div>
    <div class="timeline-day-meta">${day.local} · ${day.totalMin >= 60 ? (day.totalMin/60).toFixed(1)+' hours' : Math.round(day.totalMin)+' min'} total screen time</div>
    <div class="timeline-apps">${appsHtml}</div>
    ${noteHtml}
  `;
  timelineEl.appendChild(el);
});

// ============================================================
// HOURLY HEATMAP (local time)
// ============================================================
// Sessions by local hour (UTC hour - 5)
const hourlyDataUTC = {0:30,1:12,2:37,3:9,14:1,15:14,16:17,17:19,18:56,19:31,20:36,21:42,22:14,23:28};
// Convert to local (EST = UTC-5)
const hourlyLocal = {};
for (let h = 0; h < 24; h++) hourlyLocal[h] = 0;
for (const [utcH, count] of Object.entries(hourlyDataUTC)) {
  let localH = (parseInt(utcH) - 5 + 24) % 24;
  hourlyLocal[localH] += count;
}

const heatmapEl = document.getElementById("heatmap");
const maxHourly = Math.max(...Object.values(hourlyLocal));

// Hour labels
let hoursRow = '<div class="heatmap-hours"><div></div>';
for (let h = 0; h < 24; h++) {
  hoursRow += `<div class="heatmap-hour">${h === 0 ? '12a' : h < 12 ? h+'a' : h === 12 ? '12p' : (h-12)+'p'}</div>`;
}
hoursRow += '</div>';
heatmapEl.innerHTML = hoursRow;

// Single row
let row = '<div class="heatmap-row"><div class="heatmap-label">EST</div>';
for (let h = 0; h < 24; h++) {
  const val = hourlyLocal[h] || 0;
  const intensity = val / maxHourly;
  const bg = val === 0 ? 'var(--bg-secondary)' : `rgba(245, 166, 35, ${0.15 + intensity * 0.85})`;
  row += `<div class="heatmap-cell" style="background:${bg}" data-tooltip="${formatHour(h)}: ${val} sessions"></div>`;
}
row += '</div>';
heatmapEl.innerHTML += row;

function formatHour(h) {
  if (h === 0) return '12 AM';
  if (h < 12) return h + ' AM';
  if (h === 12) return '12 PM';
  return (h-12) + ' PM';
}

// ============================================================
// BATTERY CHARTS
// ============================================================

// Feb 12-13 battery data (local time offsets from midnight Feb 12)
const febBattery = [
  {t:14.60, pct:24}, {t:14.62, pct:23}, {t:14.83, pct:22}, {t:14.84, pct:21},
  {t:14.84, pct:20}, {t:14.93, pct:19}, {t:15.11, pct:18}, {t:15.17, pct:16},
  {t:15.34, pct:15}, {t:15.41, pct:14}, {t:16.16, pct:13}, {t:16.19, pct:12},
  {t:16.20, pct:11}, {t:16.22, pct:10}, {t:16.27, pct:9},
  // plugged in at ~16.27
  {t:16.28, pct:10}, {t:16.29, pct:11}, {t:16.30, pct:12}, {t:16.31, pct:13},
  {t:16.32, pct:14}, {t:16.34, pct:15}, {t:16.37, pct:16}, {t:16.39, pct:17},
  {t:16.42, pct:18}, {t:16.45, pct:19}, {t:16.48, pct:20}, {t:16.52, pct:21},
  {t:16.56, pct:22}, {t:16.60, pct:23}, {t:16.65, pct:24}, {t:16.71, pct:25},
  {t:16.79, pct:26}, {t:16.88, pct:27}, {t:16.97, pct:28},
  // unplugged ~17.29
  {t:17.35, pct:32}, {t:17.38, pct:31}, {t:17.43, pct:30}, {t:17.52, pct:29},
  {t:17.70, pct:28}, {t:17.88, pct:27},
  // plugged in again ~18.19
  {t:18.21, pct:27}, {t:18.25, pct:28}, {t:18.30, pct:29}, {t:18.38, pct:30},
  {t:18.50, pct:32}, {t:18.57, pct:33}, {t:18.73, pct:35}, {t:18.87, pct:36},
  {t:19.00, pct:37}, {t:19.10, pct:38}, {t:19.27, pct:40},
  // into Feb 13
  {t:19.42, pct:41}, {t:19.70, pct:43}, {t:20.52, pct:48},
  {t:21.10, pct:50}, {t:22.00, pct:53}, {t:23.50, pct:56},
];

const febCharging = [
  {start: 16.27, end: 17.29},
  {start: 18.19, end: 19.43},
];

drawBatteryChart('batteryFeb', febBattery, febCharging, 14, 24, 'Feb 12–13');

// Oct 11 battery — two streams
const octStreamA = [
  {t:12.74, pct:34}, {t:12.77, pct:35}, {t:12.82, pct:36}, {t:12.84, pct:37},
  {t:12.87, pct:38}, {t:12.90, pct:39}, {t:12.93, pct:40}, {t:12.97, pct:41},
  {t:12.99, pct:42},
];
const octStreamB = [
  {t:11.94, pct:4},
  {t:12.78, pct:3}, {t:12.79, pct:4}, {t:12.80, pct:5},
  {t:12.82, pct:6}, {t:12.84, pct:7}, {t:12.85, pct:8}, {t:12.87, pct:9},
  {t:12.88, pct:10}, {t:12.90, pct:11}, {t:12.92, pct:12}, {t:12.94, pct:13},
  {t:12.96, pct:14}, {t:12.98, pct:15}, {t:12.99, pct:16}, {t:13.01, pct:17},
  {t:13.03, pct:18}, {t:13.04, pct:19}, {t:13.06, pct:20}, {t:13.08, pct:21},
  {t:13.10, pct:22}, {t:13.11, pct:23},
];

drawDualBatteryChart('batteryOct', octStreamA, octStreamB, 11.5, 13.5);

function drawBatteryChart(id, data, charging, tMin, tMax, label) {
  const svg = document.getElementById(id);
  const w = 800, h = 200, pad = {top: 20, right: 20, bottom: 30, left: 45};
  const cw = w - pad.left - pad.right;
  const ch = h - pad.top - pad.bottom;

  let html = '';

  // Charging zones
  charging.forEach(c => {
    const x1 = pad.left + ((c.start - tMin) / (tMax - tMin)) * cw;
    const x2 = pad.left + ((c.end - tMin) / (tMax - tMin)) * cw;
    html += `<rect x="${x1}" y="${pad.top}" width="${x2-x1}" height="${ch}" fill="rgba(61,214,140,0.08)" />`;
  });

  // Grid lines
  for (let pct = 0; pct <= 60; pct += 20) {
    const y = pad.top + ch - (pct / 60) * ch;
    html += `<line x1="${pad.left}" y1="${y}" x2="${w-pad.right}" y2="${y}" stroke="var(--border)" stroke-width="0.5" />`;
    html += `<text x="${pad.left-8}" y="${y+4}" text-anchor="end" fill="var(--text-muted)" font-family="var(--mono)" font-size="9">${pct}%</text>`;
  }

  // Hour labels
  for (let t = Math.ceil(tMin); t <= tMax; t++) {
    const x = pad.left + ((t - tMin) / (tMax - tMin)) * cw;
    const hr = t % 24;
    const label = hr === 0 ? '12a' : hr < 12 ? hr+'a' : hr === 12 ? '12p' : (hr-12)+'p';
    html += `<text x="${x}" y="${h-6}" text-anchor="middle" fill="var(--text-muted)" font-family="var(--mono)" font-size="9">${label}</text>`;
  }

  // Line
  let pathD = '';
  data.forEach((d, i) => {
    const x = pad.left + ((d.t - tMin) / (tMax - tMin)) * cw;
    const y = pad.top + ch - (d.pct / 60) * ch;
    pathD += (i === 0 ? 'M' : 'L') + `${x},${y}`;
  });
  html += `<path d="${pathD}" fill="none" stroke="var(--accent-amber)" stroke-width="2" stroke-linejoin="round" />`;

  // Dots
  data.forEach(d => {
    const x = pad.left + ((d.t - tMin) / (tMax - tMin)) * cw;
    const y = pad.top + ch - (d.pct / 60) * ch;
    html += `<circle cx="${x}" cy="${y}" r="2.5" fill="var(--accent-amber)" />`;
  });

  svg.innerHTML = html;
}

function drawDualBatteryChart(id, streamA, streamB, tMin, tMax) {
  const svg = document.getElementById(id);
  const w = 800, h = 200, pad = {top: 20, right: 20, bottom: 30, left: 45};
  const cw = w - pad.left - pad.right;
  const ch = h - pad.top - pad.bottom;
  const pctMax = 50;

  let html = '';

  // Grid
  for (let pct = 0; pct <= pctMax; pct += 10) {
    const y = pad.top + ch - (pct / pctMax) * ch;
    html += `<line x1="${pad.left}" y1="${y}" x2="${w-pad.right}" y2="${y}" stroke="var(--border)" stroke-width="0.5" />`;
    html += `<text x="${pad.left-8}" y="${y+4}" text-anchor="end" fill="var(--text-muted)" font-family="var(--mono)" font-size="9">${pct}%</text>`;
  }

  // Time labels
  for (let t = 12; t <= 13.5; t += 0.25) {
    const x = pad.left + ((t - tMin) / (tMax - tMin)) * cw;
    const mins = Math.round((t % 1) * 60);
    const hr = Math.floor(t);
    const label = `${hr > 12 ? hr-12 : hr}:${mins.toString().padStart(2,'0')}p`;
    html += `<text x="${x}" y="${h-6}" text-anchor="middle" fill="var(--text-muted)" font-family="var(--mono)" font-size="9">${label}</text>`;
  }

  // Stream A line (amber)
  let pathA = '';
  streamA.forEach((d, i) => {
    const x = pad.left + ((d.t - tMin) / (tMax - tMin)) * cw;
    const y = pad.top + ch - (d.pct / pctMax) * ch;
    pathA += (i === 0 ? 'M' : 'L') + `${x},${y}`;
  });
  html += `<path d="${pathA}" fill="none" stroke="var(--accent-amber)" stroke-width="2.5" stroke-linejoin="round" />`;
  streamA.forEach(d => {
    const x = pad.left + ((d.t - tMin) / (tMax - tMin)) * cw;
    const y = pad.top + ch - (d.pct / pctMax) * ch;
    html += `<circle cx="${x}" cy="${y}" r="3" fill="var(--accent-amber)" />`;
  });

  // Stream B line (blue)
  let pathB = '';
  streamB.forEach((d, i) => {
    const x = pad.left + ((d.t - tMin) / (tMax - tMin)) * cw;
    const y = pad.top + ch - (d.pct / pctMax) * ch;
    pathB += (i === 0 ? 'M' : 'L') + `${x},${y}`;
  });
  html += `<path d="${pathB}" fill="none" stroke="var(--accent-blue)" stroke-width="2.5" stroke-linejoin="round" />`;
  streamB.forEach(d => {
    const x = pad.left + ((d.t - tMin) / (tMax - tMin)) * cw;
    const y = pad.top + ch - (d.pct / pctMax) * ch;
    html += `<circle cx="${x}" cy="${y}" r="3" fill="var(--accent-blue)" />`;
  });

  // Legend
  html += `<rect x="${w-pad.right-180}" y="${pad.top+5}" width="170" height="44" rx="4" fill="var(--bg-card)" stroke="var(--border)" />`;
  html += `<line x1="${w-pad.right-165}" y1="${pad.top+20}" x2="${w-pad.right-145}" y2="${pad.top+20}" stroke="var(--accent-amber)" stroke-width="2.5" />`;
  html += `<text x="${w-pad.right-140}" y="${pad.top+24}" fill="var(--text-secondary)" font-family="var(--mono)" font-size="10">Stream A (34→42%)</text>`;
  html += `<line x1="${w-pad.right-165}" y1="${pad.top+38}" x2="${w-pad.right-145}" y2="${pad.top+38}" stroke="var(--accent-blue)" stroke-width="2.5" />`;
  html += `<text x="${w-pad.right-140}" y="${pad.top+42}" fill="var(--text-secondary)" font-family="var(--mono)" font-size="10">Stream B (3→23%)</text>`;

  svg.innerHTML = html;
}
</script>

</body>
</html>